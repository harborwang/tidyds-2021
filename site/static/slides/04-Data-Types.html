<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Data Types</title>
    <meta charset="utf-8" />
    <meta name="author" content="W. Jake Thompson" />
    <meta name="date" content="2021-03-29" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/shareon/shareon.min.css" rel="stylesheet" />
    <script src="libs/shareon/shareon.min.js"></script>
    <link href="libs/xaringanExtra-shareagain/shareagain.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-shareagain/shareagain.js"></script>
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <link href="libs/xaringanExtra-extra-styles/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <script src="libs/fabric/fabric.min.js"></script>
    <link href="libs/xaringanExtra-scribble/scribble.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-scribble/scribble.js"></script>
    <script>document.addEventListener('DOMContentLoaded', function() { window.xeScribble = new Scribble({"pen_color":["#009FB7"],"pen_size":3,"eraser_size":30}) })</script>
    <link href="libs/countdown/countdown.css" rel="stylesheet" />
    <script src="libs/countdown/countdown.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/my-theme.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/my-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">




class: title-slide, center

&lt;span class="fa-stack fa-4x"&gt;
  &lt;i class="fa fa-circle fa-stack-2x" style="color: #ffffff;"&gt;&lt;/i&gt;
  &lt;strong class="fa-stack-1x" style="color:#009FB7;"&gt;4&lt;/strong&gt;
&lt;/span&gt; 

# Data Types

## Tidy Data Science with the Tidyverse and Tidymodels

### W. Jake Thompson

#### [https://tidyds-2021.wjakethompson.com](https://tidyds-2021.wjakethompson.com) &amp;#183; [https://bit.ly/tidyds-2021](https://bit.ly/tidyds-2021)

.footer-license[*Tidy Data Science with the Tidyverse and Tidymodels* is licensed under a [Creative Commons Attribution 4.0 International License](https://creativecommons.org/licenses/by/4.0/).]

&lt;div style = "position:fixed; visibility: hidden"&gt;
`$$\require{color}\definecolor{yellow}{rgb}{0.996078431372549, 0.843137254901961, 0.4}$$`
`$$\require{color}\definecolor{blue}{rgb}{0, 0.623529411764706, 0.717647058823529}$$`
&lt;/div&gt;

&lt;script type="text/x-mathjax-config"&gt;
MathJax.Hub.Config({
  TeX: {
    Macros: {
      yellow: ["{\\color{yellow}{#1}}", 1],
      blue: ["{\\color{blue}{#1}}", 1]
    },
    loader: {load: ['[tex]/color']},
    tex: {packages: {'[+]': ['color']}}
  }
});
&lt;/script&gt;

&lt;style&gt;
.yellow {color: #FED766;}
.blue {color: #009FB7;}
&lt;/style&gt;

---
class: pop-quiz

# Pop quiz!

What types of data are in this data set?


```
# A tibble: 336,776 x 6
   time_hour           name          air_time             distance day   delayed
   &lt;dttm&gt;              &lt;chr&gt;         &lt;Duration&gt;              &lt;dbl&gt; &lt;ord&gt; &lt;lgl&gt;  
 1 2013-01-01 05:00:00 United Air L… 13620s (~3.78 hours)     1400 Tues… TRUE   
 2 2013-01-01 05:00:00 United Air L… 13620s (~3.78 hours)     1416 Tues… TRUE   
 3 2013-01-01 05:00:00 American Air… 9600s (~2.67 hours)      1089 Tues… TRUE   
 4 2013-01-01 05:00:00 JetBlue Airw… 10980s (~3.05 hours)     1576 Tues… FALSE  
 5 2013-01-01 06:00:00 Delta Air Li… 6960s (~1.93 hours)       762 Tues… FALSE  
 6 2013-01-01 05:00:00 United Air L… 9000s (~2.5 hours)        719 Tues… TRUE   
 7 2013-01-01 06:00:00 JetBlue Airw… 9480s (~2.63 hours)      1065 Tues… TRUE   
 8 2013-01-01 06:00:00 ExpressJet A… 3180s (~53 minutes)       229 Tues… FALSE  
 9 2013-01-01 06:00:00 JetBlue Airw… 8400s (~2.33 hours)       944 Tues… FALSE  
10 2013-01-01 06:00:00 American Air… 8280s (~2.3 hours)        733 Tues… TRUE   
# … with 336,766 more rows
```

---
background-image: url(images/data-types/applied-ds-prog.png)
background-position: center 60%
background-size: 85%

# .nobold[(Applied)] Data Science

---
background-image: url(images/data-types/applied-ds-trans-prog.png)
background-position: center 60%
background-size: 85%

# .nobold[(Applied)] Data Science

---
name: logicals
class: center middle

# logicals

---
# Logicals

R's data type for Boolean values (i.e., `TRUE` and `FALSE`)


```r
typeof(TRUE)
#&gt; [1] "logical"

typeof(FALSE)
#&gt; [1] "logical"

typeof(c(TRUE, TRUE, FALSE))
#&gt; [1] "logical"
```

---


```r
flights %&gt;%
  mutate(delayed = arr_delay &gt; 0) %&gt;%
  select(arr_delay, delayed)
#&gt; # A tibble: 336,776 x 2
#&gt;    arr_delay delayed
#&gt;        &lt;dbl&gt; &lt;lgl&gt;  
#&gt;  1        11 TRUE   
#&gt;  2        20 TRUE   
#&gt;  3        33 TRUE   
#&gt;  4       -18 FALSE  
#&gt;  5       -25 FALSE  
#&gt;  6        12 TRUE   
#&gt;  7        19 TRUE   
#&gt;  8       -14 FALSE  
#&gt;  9        -8 FALSE  
#&gt; 10         8 TRUE   
#&gt; # … with 336,766 more rows
```

--

Can we compute the proportion of flights that arrived late?

---
# Most useful skills

* Math with logicals
  * When you do math with logicals, `TRUE` becomes **1** and `FALSE` becomes **0**

--

* The **sum** of a logical vector is the **count of `TRUE`s**

```r
sum(c(TRUE, FALSE, TRUE, TRUE))
#&gt; [1] 3
```

--

* The **mean** of a logical vector is the **proportion of `TRUE`s**

```r
mean(c(1, 2, 3, 4) &lt; 4)
#&gt; [1] 0.75
```

---
class: your-turn

# Your turn 1

.big[
Use the `flights` data set to create a new variable, **`delayed`** that indicates if the flight was delayed (**`arr_delay &gt; 0`**).

Then, remove all rows that contain an `NA` in the **`delayed`** variable.

Finally, create a summary table that shows:

1. How many flight were delayed?
2. What proportion of flights were delayed?
]

<div class="countdown" id="timer_60629a98" style="right:0;bottom:0;font-size:2em;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">04</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
class: your-turn


```r
flights %&gt;%
  mutate(delayed = arr_delay &gt; 0) %&gt;%
  drop_na(delayed) %&gt;%
  summarize(total = sum(delayed), prop = mean(delayed))
#&gt; # A tibble: 1 x 2
#&gt;    total  prop
#&gt;    &lt;int&gt; &lt;dbl&gt;
#&gt; 1 133004 0.406
```

---
name: strings
class: center middle

# strings

---
# .nobold[(character)] strings

Anything surrounded by quotes (`"`) or single quotes (`'`)

```r
&gt; "one"
&gt; "1"
&gt; "one's"
&gt; '"Hello World"'
&gt; "foo
+
+
+ oops. I'm stuck in a string."
```

---
class: pop-quiz

# Consider

Discuss in the chat: Are boys or girls names more likely to end in a vowel?

<div class="countdown" id="timer_60629885" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">01</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
class: pop-quiz

How can we calculate the proportion of boys and girls names that end in a vowel?


```r
babynames
#&gt; # A tibble: 1,924,665 x 5
#&gt;     year sex   name          n   prop
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;
#&gt;  1  1880 F     Mary       7065 0.0724
#&gt;  2  1880 F     Anna       2604 0.0267
#&gt;  3  1880 F     Emma       2003 0.0205
#&gt;  4  1880 F     Elizabeth  1939 0.0199
#&gt;  5  1880 F     Minnie     1746 0.0179
#&gt;  6  1880 F     Margaret   1578 0.0162
#&gt;  7  1880 F     Ida        1472 0.0151
#&gt;  8  1880 F     Alice      1414 0.0145
#&gt;  9  1880 F     Bertha     1320 0.0135
#&gt; 10  1880 F     Sarah      1288 0.0132
#&gt; # … with 1,924,655 more rows
```

---
# Most useful skills

1\. How to extract or replace substrings.

.fade[
2\. How to find matches for patterns.

3\. Regular expressions.
]

---
&lt;div class="hex-book"&gt;
  &lt;a href="https://stringr.tidyverse.org"&gt;
    &lt;img class="hex" src="images/hex/stringr.png"&gt;
  &lt;/a&gt;
  &lt;a href="https://r4ds.had.co.nz/strings.html"&gt;
    &lt;img class="book" src="images/books/r4ds-strings.png"&gt;
  &lt;/a&gt;
&lt;/div&gt;

---
# `str_sub()`

Extract or replace portions of a string with **`str_sub()`**




&lt;code class ='r hljs remark-code'&gt;str_sub(string, start = 1, end = -1)&lt;/code&gt;

---
# `str_sub()`

Extract or replace portions of a string with **`str_sub()`**


&lt;code class ='r hljs remark-code'&gt;str_sub(&lt;span style="background-color:#FED766;color:#009FB7"&gt;string&lt;/span&gt;, start = 1, end = -1)&lt;/code&gt;

???

string(s) to manipulate

---
# `str_sub()`

Extract or replace portions of a string with **`str_sub()`**


&lt;code class ='r hljs remark-code'&gt;str_sub(string, start = &lt;span style="background-color:#FED766;color:#009FB7"&gt;1&lt;/span&gt;, end = -1)&lt;/code&gt;

???

position of the first character to extract within each string

---
# `str_sub()`

Extract or replace portions of a string with **`str_sub()`**


&lt;code class ='r hljs remark-code'&gt;str_sub(string, start = 1, end = &lt;span style="background-color:#FED766;color:#009FB7"&gt;-1&lt;/span&gt;)&lt;/code&gt;

???

position of the last character to extract within each string

---
class: pop-quiz

# Pop quiz!

What will this return?


```r
str_sub("Mephisto", 1, 2)
```

--


```
#&gt; [1] "Me"
```

---
class: pop-quiz

# Pop quiz!

What will this return?


```r
str_sub("Mephisto", 1, 2)
```

--


```
#&gt; [1] "Me"
```

---
class: pop-quiz

# Pop quiz!

What will this return?


```r
str_sub("Mephisto", 2)
```

--


```
#&gt; [1] "ephisto"
```

---
class: pop-quiz

# Pop quiz!

What will this return?


```r
str_sub("Mephisto", -3)
```

--


```
#&gt; [1] "sto"
```

---
class: pop-quiz

# Pop quiz!

What will this return?


```r
m &lt;- "Mephisto"
str_sub(m, -3) &lt;- "--Agatha!"
m
```

--


```
#&gt; [1] "Mephi--Agatha!"
```

---
class: your-turn

# Your turn 2

Complete the following code to:

1. Isolate the last letter of every **`name`**.
2. Create a variable that indicates whether the last letter is one of "a", "e", "i", "o", "u", or "y".
3. Calculate the proportion of children whose name ends in a vowel, by **`year`** and **`sex`**.
4. Display the results as a line plot.




&lt;code class ='r hljs remark-code'&gt;babynames %&gt;%&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;span style="background-color:#FED766"&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;(last = &lt;span style="background-color:#FED766"&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;vowel = &lt;span style="background-color:#FED766"&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;) %&gt;%&lt;br&gt;&amp;nbsp;&amp;nbsp;group_by(&lt;span style="background-color:#FED766"&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;) %&gt;%&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;span style="background-color:#FED766"&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;(prop_vowel = weighted.mean(vowel, w = n)) %&gt;%&lt;br&gt;&amp;nbsp;&amp;nbsp;ggplot(mapping = aes(x = &lt;span style="background-color:#FED766"&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;, y = &lt;span style="background-color:#FED766;color:#FED766"&gt;prop_vowel&lt;/span&gt;)) +&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;span style="background-color:#FED766"&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;(mapping = &lt;span style="background-color:#FED766"&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;)&lt;/code&gt;

<div class="countdown" id="timer_60629a4a" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
class: your-turn

.panelset[
.panel[.panel-name[Code]

```r
babynames %&gt;%
  mutate(last = str_sub(name, start = -1, end = -1),
         vowel = last %in% c("a", "e", "i", "o", "u", "y")) %&gt;%
  group_by(year, sex) %&gt;%
  summarize(prop_vowel = weighted.mean(vowel, w = n)) %&gt;%
  ggplot(mapping = aes(x = year, y = prop_vowel)) +
  geom_line(mapping = aes(color = sex))
```

]

.panel[.panel-name[Plot]

&lt;img src="images/data-types/plots/yt-year-sol-1.png" width="80%" style="display: block; margin: auto;" /&gt;

]
]

---
name: factors
class: center middle

# factors

---
# Factors

R's representation of categorical data. Consists of:

1. A set of **values**
2. An ordered set of **valid levels**


```r
eyes &lt;- factor(x = c("blue", "green", "green"),
               levels = c("blue", "brown", "green", "hazel"))

eyes
#&gt; [1] blue  green green
#&gt; Levels: blue brown green hazel
```

---
# Factors

Stored internally as an integer vector with a levels attribute


```r
unclass(eyes)
#&gt; [1] 1 3 3
#&gt; attr(,"levels")
#&gt; [1] "blue"  "brown" "green" "hazel"
```

---
&lt;div class="hex-book"&gt;
  &lt;a href="https://forcats.tidyverse.org"&gt;
    &lt;img class="hex" src="images/hex/forcats.png"&gt;
  &lt;/a&gt;
  &lt;a href="https://r4ds.had.co.nz/factors.html"&gt;
    &lt;img class="book" src="images/books/r4ds-factors.png"&gt;
  &lt;/a&gt;
&lt;/div&gt;

---
class: pop-quiz

# Consider

Discuss in the chat: Do married people watch more or less TV than single people?

<div class="countdown" id="timer_606299f3" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">01</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
# Example data: `gss_cat`


```r
gss_cat
#&gt; # A tibble: 21,483 x 9
#&gt;     year marital     age race  rincome    partyid     relig     denom    tvhours
#&gt;    &lt;int&gt; &lt;fct&gt;     &lt;int&gt; &lt;fct&gt; &lt;fct&gt;      &lt;fct&gt;       &lt;fct&gt;     &lt;fct&gt;      &lt;int&gt;
#&gt;  1  2000 Never ma…    26 White $8000 to … Ind,near r… Protesta… Souther…      12
#&gt;  2  2000 Divorced     48 White $8000 to … Not str re… Protesta… Baptist…      NA
#&gt;  3  2000 Widowed      67 White Not appli… Independent Protesta… No deno…       2
#&gt;  4  2000 Never ma…    39 White Not appli… Ind,near r… Orthodox… Not app…       4
#&gt;  5  2000 Divorced     25 White Not appli… Not str de… None      Not app…       1
#&gt;  6  2000 Married      25 White $20000 - … Strong dem… Protesta… Souther…      NA
#&gt;  7  2000 Never ma…    36 White $25000 or… Not str re… Christian Not app…       3
#&gt;  8  2000 Divorced     44 White $7000 to … Ind,near d… Protesta… Luthera…      NA
#&gt;  9  2000 Married      44 White $25000 or… Not str de… Protesta… Other          0
#&gt; 10  2000 Married      47 White $25000 or… Strong rep… Protesta… Souther…       3
#&gt; # … with 21,473 more rows
```

???

A sample of data from teh General Social Survey, a long-running US survey conducted by NORC at the University of Chicago.

---
# Which religions watch the least TV?


```r
gss_cat %&gt;%
  drop_na(tvhours) %&gt;%
  group_by(relig) %&gt;%
  summarize(tvhours = mean(tvhours)) %&gt;%
  ggplot(mapping = aes(x = tvhours, y= relig)) +
  geom_point()
```

---
# Which plot do you prefer?


.pull-left[
&lt;img src="images/data-types/plots/religion-tv-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

.pull-right[
&lt;img src="images/data-types/plots/religion-tv-order-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---
class: center middle

&lt;img src="images/data-types/plots/religion-tv-1.png" width="90%" style="display: block; margin: auto;" /&gt;

???

Why is the y-axis in this order?

---
# `levels()`

Use **`levels()`** to access a factor's levels


```r
levels(gss_cat$relig)
#&gt;  [1] "No answer"               "Don't know"             
#&gt;  [3] "Inter-nondenominational" "Native american"        
#&gt;  [5] "Christian"               "Orthodox-christian"     
#&gt;  [7] "Moslem/islam"            "Other eastern"          
#&gt;  [9] "Hinduism"                "Buddhism"               
#&gt; [11] "Other"                   "None"                   
#&gt; [13] "Jewish"                  "Catholic"               
#&gt; [15] "Protestant"              "Not applicable"
```

---


.smallish[

```r
levels(gss_cat$relig)
#&gt;  [1] "No answer"               "Don't know"              "Inter-nondenominational"
#&gt;  [4] "Native american"         "Christian"               "Orthodox-christian"     
#&gt;  [7] "Moslem/islam"            "Other eastern"           "Hinduism"               
#&gt; [10] "Buddhism"                "Other"                   "None"                   
#&gt; [13] "Jewish"                  "Catholic"                "Protestant"             
#&gt; [16] "Not applicable"
```
]

&lt;img src="images/data-types/plots/religion-tv-1.png" width="65%" style="display: block; margin: auto;" /&gt;



---
# Most useful skills

1. Reorder the levels
2. Recode the levels
3. Collapse levels

---
class: center middle

.large-left[
# Reordering levels
]

.small-right[
&lt;img src="images/hex/forcats.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---
# `fct_reorder()`

Reorders the levels of a factor based on the result of **`fun(x)`** applied to each group of cases (grouped by level).




&lt;code class ='r hljs remark-code'&gt;fct_reorder(f, x, fun = median, ..., .desc = FALSE)&lt;/code&gt;


---
# `fct_reorder()`

Reorders the levels of a factor based on the result of **`fun(x)`** applied to each group of cases (grouped by level).


&lt;code class ='r hljs remark-code'&gt;fct_reorder(&lt;span style="background-color:#FED766;color:#009FB7"&gt;f&lt;/span&gt;, x, fun = median, ..., .desc = FALSE)&lt;/code&gt;

???

Factor to reorder

---
# `fct_reorder()`

Reorders the levels of a factor based on the result of **`fun(x)`** applied to each group of cases (grouped by level).


&lt;code class ='r hljs remark-code'&gt;fct_reorder(f, &lt;span style="background-color:#FED766;color:#009FB7"&gt;x&lt;/span&gt;, fun = median, ..., .desc = FALSE)&lt;/code&gt;

???

variable to reorder by (in conjunction with `fun`)

---
# `fct_reorder()`

Reorders the levels of a factor based on the result of **`fun(x)`** applied to each group of cases (grouped by level).


&lt;code class ='r hljs remark-code'&gt;fct_reorder(f, x, &lt;span style="background-color:#FED766;color:#009FB7"&gt;fun = median&lt;/span&gt;, ..., .desc = FALSE)&lt;/code&gt;

???

function to reorder by (in conjunction with `x`)

---
# `fct_reorder()`

Reorders the levels of a factor based on the result of **`fun(x)`** applied to each group of cases (grouped by level).


&lt;code class ='r hljs remark-code'&gt;fct_reorder(f, x, fun = median, ..., &lt;span style="background-color:#FED766;color:#009FB7"&gt;.desc = FALSE&lt;/span&gt;)&lt;/code&gt;

???

put in descending order?

---

.panelset[
.panel[.panel-name[Code]

&lt;code class ='r hljs remark-code'&gt;gss_cat %&gt;%&lt;br&gt;&amp;nbsp;&amp;nbsp;drop_na(tvhours) %&gt;%&lt;br&gt;&amp;nbsp;&amp;nbsp;group_by(relig) %&gt;%&lt;br&gt;&amp;nbsp;&amp;nbsp;summarize(tvhours = mean(tvhours)) %&gt;%&lt;br&gt;&amp;nbsp;&amp;nbsp;ggplot(mapping = aes(x = tvhours, y = &lt;span style="background-color:#FED766;color:#009FB7"&gt;fct_reorder(relig, tvhours, mean)&lt;/span&gt;)) +&lt;br&gt;&amp;nbsp;&amp;nbsp;geom_point()&lt;/code&gt;
]

.panel[.panel-name[Plot]
&lt;img src="images/data-types/plots/religion-tv-order-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]
]

---
class: your-turn

# Your turn 3

Complete the following code to:

1. Calculate the average number of **`tvhours`**, by marital status.
2. Create a sensible plot of average TV consumption by marital status.




&lt;code class ='r hljs remark-code'&gt;gss_cat %&gt;%&lt;br&gt;&amp;nbsp;&amp;nbsp;drop_na(tvhours) %&gt;%&lt;br&gt;&amp;nbsp;&amp;nbsp;group_by(&lt;span style="background-color:#FED766;color:#FED766"&gt;marital&lt;/span&gt;) %&gt;%&lt;br&gt;&amp;nbsp;&amp;nbsp;summarize(&lt;span style="background-color:#FED766"&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;) %&gt;%&lt;br&gt;&amp;nbsp;&amp;nbsp;ggplot(mapping = &lt;span style="background-color:#FED766"&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;) +&lt;br&gt;&amp;nbsp;&amp;nbsp;geom_col()&lt;/code&gt;

<div class="countdown" id="timer_606299e9" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
class: your-turn

.panelset[
.panel[.panel-name[Code]

```r
gss_cat %&gt;%
  drop_na(tvhours) %&gt;%
  group_by(marital) %&gt;%
  summarize(tvhours = mean(tvhours)) %&gt;%
  ggplot(mapping = aes(x = tvhours,y = fct_reorder(marital, tvhours, mean))) +
  geom_col()
```

]

.panel[.panel-name[Plot]

&lt;img src="images/data-types/plots/yt-married-tv-sol-1.png" width="80%" style="display: block; margin: auto;" /&gt;

]
]

---
# `fct_infreq()`




```r
ggplot(gss_cat, mapping = aes(x = fct_infreq(marital))) +
  geom_bar()
```

.pull-left[
&lt;img src="images/data-types/plots/infreq-default-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

.pull-right[
&lt;img src="images/data-types/plots/infreq-order-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---
# `fct_rev()`


```r
ggplot(gss_cat, mapping = aes(x = fct_rev(fct_infreq(marital)))) +
  geom_bar()
```

.pull-left[
&lt;img src="images/data-types/plots/infreq-order-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

.pull-right[
&lt;img src="images/data-types/plots/rev-order-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---
class: center middle

.large-left[
# Recoding levels
]

.small-right[
&lt;img src="images/hex/forcats.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---
class: your-turn

# Your turn 4

Do liberals or conservatives watch more TV?

Compute the average TV consumption by party identification, and plot the results.

<div class="countdown" id="timer_60629af9" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
class: your-turn

.panelset[
.panel[.panel-name[Code]

```r
gss_cat %&gt;%
  drop_na(tvhours) %&gt;%
  group_by(partyid) %&gt;%
  summarize(tvhours = mean(tvhours)) %&gt;%
  ggplot(mapping = aes(x = tvhours,y = fct_reorder(partyid, tvhours, mean))) +
  geom_col() +
  labs(y = "partyid")
```

]

.panel[.panel-name[Plot]

&lt;img src="images/data-types/plots/party-tv-sol-1.png" width="80%" style="display: block; margin: auto;" /&gt;

]
]

???

How can we improve these labels?

---
# `fct_recode()`

Change the values of the levels for a factor




&lt;code class ='r hljs remark-code'&gt;fct_recode(f, ...)&lt;/code&gt;

---
# `fct_recode()`

Change the values of the levels for a factor


&lt;code class ='r hljs remark-code'&gt;fct_recode(&lt;span style="background-color:#FED766;color:#009FB7"&gt;f&lt;/span&gt;, ...)&lt;/code&gt;

???

factor variable

---
# `fct_recode()`

Change the values of the levels for a factor


&lt;code class ='r hljs remark-code'&gt;fct_recode(f, &lt;span style="background-color:#FED766;color:#009FB7"&gt;...&lt;/span&gt;)&lt;/code&gt;

???

new level = old level pairs

---
.panelset[
.panel[.panel-name[Code]

```r
gss_cat %&gt;%
  drop_na(tvhours) %&gt;%
  mutate(partyid = fct_recode(partyid,
                              "Republican, strong" = "Strong republican",
                              "Republican, weak"   = "Not str republican",
                              "Republican, lean"   = "Ind,near rep",
                              "Democrat, lean"     = "Ind,near dem",
                              "Democrat, weak"     = "Not str democrat",
                              "Democrat, strong"   = "Strong democrat")) %&gt;%
  group_by(partyid) %&gt;%
  summarize(tvhours = mean(tvhours)) %&gt;%
  ggplot(mapping = aes(x = tvhours, y = fct_reorder(partyid, tvhours, mean))) +
  geom_col() +
  labs(y = "partyid")
```

]

.panel[.panel-name[Plot]

&lt;img src="images/data-types/plots/party-recode-1.png" width="80%" style="display: block; margin: auto;" /&gt;

]
]

---
&lt;img src="images/data-types/plots/party-recode-1.png" width="90%" style="display: block; margin: auto;" /&gt;

---
&lt;img src="images/data-types/plots/red-party-1.png" width="90%" style="display: block; margin: auto;" /&gt;

---
&lt;img src="images/data-types/plots/blue-party-1.png" width="90%" style="display: block; margin: auto;" /&gt;

???

How can we combine these groups?

---
class: center middle

.large-left[
# Collapsing levels
]

.small-right[
&lt;img src="images/hex/forcats.png" width="100%" style="display: block; margin: auto;" /&gt;
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "solarized-light",
"highlightLanguage": ["r", "css", "yaml"],
"slideNumberFormat": "",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
