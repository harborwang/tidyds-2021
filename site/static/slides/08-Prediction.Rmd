---
title: "Prediction"
subtitle: "Tidy Data Science with the Tidyverse and Tidymodels"
session: 8
author: W. Jake Thompson
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: ["default", "assets/css/my-theme.css", "assets/css/my-fonts.css"]
    seal: false 
    lib_dir: libs
    nature:
      # autoplay: 5000
      highlightStyle: solarized-light
      highlightLanguage: ["r", "css", "yaml"]
      slideNumberFormat: "" 
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
      beforeInit: "https://platform.twitter.com/widgets.js"
    includes:
      in_header: [assets/header.html]
params:
  site_link: "https://bit.ly/tidyds-2021"
  class_link: "https://tidyds-2021.wjakethompson.com"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(collapse = TRUE,
                      fig.retina = 3,
                      fig.path = "images/prediction/plots/",
                      fig.align = "center",
                      fig.asp = 0.618,
                      comment = "#>")

xaringanExtra::use_share_again()
xaringanExtra::use_panelset()
xaringanExtra::use_extra_styles(hover_code_line = TRUE,
                                mute_unhighlighted_code = TRUE)
xaringanExtra::use_scribble(pen_color = "#009FB7")

yt_counter <- 0
library(countdown)
library(tidyverse)
library(flair)
library(here)
library(knitr)

library(xaringancolor)
yellow <- "#FED766"
blue <- "#009FB7"

library(AmesHousing)
ames <- make_ames()
```

class: title-slide, center

<span class="fa-stack fa-4x">
  <i class="fa fa-circle fa-stack-2x" style="color: #ffffff;"></i>
  <strong class="fa-stack-1x" style="color:#009FB7;">`r rmarkdown::metadata$session`</strong>
</span> 

# `r rmarkdown::metadata$title`

## `r rmarkdown::metadata$subtitle`

### `r rmarkdown::metadata$author`

#### [`r params$class_link`](`r params$class_link`) &#183; [`r params$site_link`](`r params$site_link`)

.footer-license[*Tidy Data Science with the Tidyverse and Tidymodels* is licensed under a [Creative Commons Attribution 4.0 International License](https://creativecommons.org/licenses/by/4.0/).]

<div style = "position:fixed; visibility: hidden">
$$\require{color}\definecolor{yellow}{rgb}{0.996078431372549, 0.843137254901961, 0.4}$$
$$\require{color}\definecolor{blue}{rgb}{0, 0.623529411764706, 0.717647058823529}$$
</div>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
    Macros: {
      yellow: ["{\\color{yellow}{#1}}", 1],
      blue: ["{\\color{blue}{#1}}", 1]
    },
    loader: {load: ['[tex]/color']},
    tex: {packages: {'[+]': ['color']}}
  }
});
</script>

<style>
.yellow {color: #FED766;}
.blue {color: #009FB7;}
</style>

---
class: your-turn

# Your Turn 0

.big[
* Open the R Notebook **materials/exercises/08-prediction.Rmd**
* Run the setup chunk
]

```{r yt-setwd-cd, echo = FALSE}
countdown(minutes = 1, seconds = 0,
          font_size = "2em",
          color_border = yellow,
          color_background = blue,
          color_text = yellow,
          color_running_background = "#F0F0F0",
          color_running_text = blue,
          color_finished_background = yellow,
          color_finished_text = blue)
```

---
background-image: url(images/prediction/applied-ds-model.png)
background-position: center 60%
background-size: 85%

# .nobold[(Applied)] Data Science

---
class: center middle

# What is a model?

---
# Models

A low dimensional description of a higher dimensional data set.

.columns[
.left-col[
```{r model-1, echo = FALSE, out.width = "100%", fig.asp = 1, message = FALSE, warning = FALSE}
tibble(x = rnorm(100)) %>%
  mutate(y = x + rnorm(n(), sd = 0.3)) %>%
  ggplot(aes(x, y)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  theme_bw()
```
]

.middle-col[
```{r model-2, echo = FALSE, out.width = "100%", fig.asp = 1, message = FALSE, warning = FALSE}
tibble(x = rnorm(100)) %>%
  mutate(y = (x ^ 3) / 3 + rnorm(n(), sd = 0.3)) %>%
  ggplot(aes(x, y)) +
  geom_point() +
  geom_smooth(method = "loess", se = FALSE) +
  theme_bw()
```
]

.right-col[
```{r model-3, echo = FALSE, out.width = "100%", fig.asp = 1, message = FALSE, warning = FALSE}
tibble(x = c(runif(100, min = -2, max = 2))) %>%
  mutate(y = (x ^ 2) + rnorm(n(), sd = 0.3),
         extra = case_when(between(y, -0.5, 0.5) ~ 1L, TRUE ~ 0L),
         error = runif(n(), min = 1, max = 2.5),
         y = y + (extra * error)) %>%
  ggplot(aes(x, y)) +
  geom_point() +
  geom_smooth(method = "loess", se = FALSE) +
  theme_bw()
```
]
]

---
# Models

```{r fake-data, include = FALSE}
set.seed(9416)
exm_data <- tibble(x = runif(30, min = 0, max = 5)) %>%
  mutate(y = x + rnorm(n(), sd = 0.6))

lm_model <- lm(y ~ x, data = exm_data)
exm_data <- broom::augment(lm_model)

exm_plot <- ggplot(exm_data, aes(x, y)) +
  geom_point(alpha = 0.6) +
  theme_void() +
  theme(plot.background = element_rect(fill = "#F0F0F0", color = NA))
```

<br>

.columns[
.left-col[
```{r raw-data, echo = FALSE, out.width = "100%", fig.width = 2, fig.asp = 1}
exm_plot
```

### Data
]

.middle-col[
```{r black-box, echo = FALSE, out.width = "80%"}
knitr::include_graphics("images/prediction/black-box.png")
```
]

.right-col[
```{r blank, echo = FALSE, out.width = "100%", fig.asp = 1}
ggplot(exm_data, aes(x, y)) +
  theme_void() +
  theme(plot.background = element_rect(fill = "#F0F0F0", color = NA))
```

### Model Function
]
]

---
# Models

What is the .blue[**model function**]?

.columns[

.left-col[
```{r raw-data, opts.label = TRUE}
```

### Data
]

.middle-col[
```{r black-box, opts.label = TRUE}
```
]

.right-col[
```{r model-func, echo = FALSE, out.width = "100%", fig.width = 2, fig.asp = 1, warning = FALSE, message = FALSE}
exm_plot +
  geom_smooth(method = "lm", color = "#009FB7", se = FALSE)
```

### Model Function
]
]

---
# Models

What .grey[**uncertainty**] is associated with it?

.columns[

.left-col[
```{r raw-data, opts.label = TRUE}
```

### Data
]

.middle-col[
```{r black-box, opts.label = TRUE}
```
]

.right-col[
```{r model-uncert, echo = FALSE, out.width = "100%", fig.width = 2, fig.asp = 1, warning = FALSE, message = FALSE}
exm_plot +
  geom_smooth(method = "lm", color = "#009FB7", se = TRUE, fill = "#696773")
```

### Model Function
]
]

---
# Models

What are the .pink[**residuals**]?

.columns[

.left-col[
```{r raw-data, opts.label = TRUE}
```

### Data
]

.middle-col[
```{r black-box, opts.label = TRUE}
```
]

.right-col[
```{r model-resid, echo = FALSE, out.width = "100%", fig.width = 2, fig.asp = 1, warning = FALSE, message = FALSE}
exm_plot +
  geom_smooth(method = "lm", color = "#009FB7", se = FALSE) +
  geom_segment(aes(xend = x, yend = .fitted), color = "#CB297B")
```

### Model Function
]
]

---
# Models

What are the .dark-yellow[**predictions**]?

.columns[

.left-col[
```{r raw-data, opts.label = TRUE}
```

### Data
]

.middle-col[
```{r black-box, opts.label = TRUE}
```
]

.right-col[
```{r model-pred, echo = FALSE, out.width = "100%", fig.width = 2, fig.asp = 1, warning = FALSE, message = FALSE}
exm_plot +
  geom_smooth(method = "lm", color = "#009FB7", se = FALSE) +
  geom_segment(aes(xend = x, yend = .fitted), color = "#CB297B") +
  geom_point(aes(y = .fitted), color = "#A27A01", size = 2)
```

### Model Function
]
]

---
background-image: url(images/prediction/algorithm.png)
background-position: center middle
background-size: cover

???

What makes an algorithm "good"?

So many... which one is "best"?

---
<div class="hex-book">
  <a href="https://tidymodels.org">
    <img class="hex" src="images/hex/tidymodels.png">
  </a>
  <a href="https://www.tmwr.org/">
    <img class="book" src="images/books/tmwr.png">
  </a>
</div>

---
class: middle, center, frame

# Goal of Machine Learning

--

## generate accurate predictions

---
# `lm()`


```{r ames-lm}
lm_ames <- lm(Sale_Price ~ Gr_Liv_Area, data = ames)
lm_ames
```


???

So let's start with prediction. To predict, we have to have two things: a model to generate predictions, and data to predict

---
background-image: url("images/prediction/train-model.png")
background-size: 50%

# Step 1: Train the model

